<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cyber Safe Mini Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#0f172a;
  --card:#020617;
  --accent:#38bdf8;
  --good:#16a34a;
  --bad:#dc2626;
  --warn:#facc15;
}
*{box-sizing:border-box}
body{
  font-family: Arial, sans-serif;
  background:var(--bg);
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  transition:background .5s;
}
.card{
  background:var(--card);
  padding:24px;
  border-radius:12px;
  width:95%;
  max-width:480px;
  text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,.5);
  transition:transform .3s, background .3s;
}
.card:hover{transform:scale(1.02);}
h1,h2{color:var(--accent);margin:8px 0}
.small{color:#94a3b8;font-size:14px}
#challenge{font-size:18px;margin:16px 0}

#options button{
  width:100%;
  margin:8px 0;
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#1e293b;
  color:#e5e7eb;
  transition:.2s;
}
#options button:hover{background:#334155;transform:scale(1.02)}

.btn{
  margin:6px;
  padding:10px 16px;
  font-size:15px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--accent);
  color:#020617;
}
.btn:hover{background:#0ea5e9}

#progress-container{
  width:100%;
  background:#1e293b;
  border-radius:6px;
  overflow:hidden;
  height:14px;
  margin:10px 0;
}
#progress-bar{
  height:100%;
  width:0%;
  background:var(--accent);
  transition:.3s;
}

#feedback{min-height:28px;font-weight:bold;margin-top:8px;transition:all .3s;}
#hint-text{color:#fbbf24;min-height:20px;font-style:italic;transition:all .3s;}
#timer{color:var(--warn);font-weight:bold;margin-top:6px}

.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  background:#1e293b;
  margin-top:6px;
  font-size:13px;
  transition:all .3s;
}

.footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  margin-top:10px;
  gap:6px;
}

.tip{
  background:#1e293b;
  padding:6px;
  margin:4px 0;
  border-radius:6px;
  text-align:left;
  font-size:14px;
}

@media(max-width:500px){
  #options button{font-size:14px;padding:10px}
}
</style>
</head>
<body>

<div id="start-screen" class="card">
  <h2>üõ°Ô∏è Cyber Safe Mini Game</h2>
  <p>Select your level to start learning cybersecurity!</p>
  <button class="btn" onclick="startGame('Beginner')">Beginner</button>
  <button class="btn" onclick="startGame('Intermediate')">Intermediate</button>
  <button class="btn" onclick="startGame('Advanced')">Advanced</button>
  <p class="small">High Scores - Beginner: <span id="best-Beginner">0</span>, Intermediate: <span id="best-Intermediate">0</span>, Advanced: <span id="best-Advanced">0</span></p>
</div>

<div id="game-container" class="card" style="display:none;">
  <h1>Cyber Safe Mini Game</h1>
  <div class="small" id="challenge-number"></div>

  <div id="progress-container"><div id="progress-bar"></div></div>

  <div id="challenge"></div>
  <div id="options"></div>

  <button class="btn" onclick="showHint()">üí° Hint</button>
  <button class="btn" onclick="togglePause()">‚è∏Ô∏è Pause</button>
  <button class="btn" onclick="toggleSound()">üîä Sound</button>

  <div id="hint-text"></div>
  <div id="feedback"></div>

  <div class="footer">
    <div id="score">Score: 0</div>
    <div id="timer">Time: 20s</div>
  </div>
</div>

<audio id="correct-sound" src="https://freesound.org/data/previews/66/66717_931655-lq.mp3"></audio>
<audio id="wrong-sound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>

<script>
// Questions by level with categories
const allChallenges = {
  Beginner:[
    {q:"Strongest password?", o:["123456","password","J$9vP#2!"], a:2, e:"Strong passwords use symbols, numbers, mixed letters.", h:"Mix letters, numbers & symbols.", cat:"Password"},
    {q:"Safe URL?", o:["http://bank-login.fake.com","https://securebank.com","http://securebank-login.com"], a:1, e:"Check HTTPS and domain.", h:"Check HTTPS and spelling.", cat:"Website"},
    {q:"Safe Wi-Fi?", o:["Free_Public","CoffeeShop","Home_Password"], a:2, e:"Private Wi-Fi is safest.", h:"Private is safer.", cat:"Network"},
    {q:"Antivirus use?", o:["Optional","Important","Dangerous"], a:1, e:"Antivirus protects from malware.", h:"Install antivirus.", cat:"Device"},
    {q:"Sharing info?", o:["Safe","Unsafe","Depends"], a:1, e:"Never share sensitive info.", h:"Keep info private.", cat:"Personal Info"}
  ],
  Intermediate:[
    {q:"2FA protection?", o:["Click links","2FA","Share passwords"], a:1, e:"2FA adds protection.", h:"Use 2FA.", cat:"Account"},
    {q:"Public Wi-Fi?", o:["Safe","Risky","No diff"], a:1, e:"Public Wi-Fi is risky.", h:"Avoid unprotected Wi-Fi.", cat:"Network"},
    {q:"Email attachments?", o:["Open all","Check sender","Send info"], a:1, e:"Verify before opening.", h:"Check sender.", cat:"Email"},
    {q:"Password storage?", o:["Paper","Manager","Share"], a:1, e:"Use password manager.", h:"Use secure storage.", cat:"Password"}
  ],
  Advanced:[
    {q:"Secure cloud?", o:["Any","Encrypted","Unsecured"], a:1, e:"Use encrypted storage.", h:"Encrypt files.", cat:"Data"},
    {q:"VPN usage?", o:["Important","Optional","Not needed"], a:0, e:"VPN protects connection.", h:"Use VPN on public Wi-Fi.", cat:"Network"},
    {q:"Spot phishing URL", o:["https://fake-paypal.com","https://paypal.com","https://paypal.fake.com"], a:1, e:"Check exact domain.", h:"Check domain.", cat:"Website"},
    {q:"Device encryption?", o:["Important","Optional","Not needed"], a:0, e:"Encrypt devices to protect data.", h:"Use encryption.", cat:"Device"}
  ]
};

let challenges=[], current=0, score=0, timeLeft=20, timer=null;
let correct=0, wrong=0, timeout=0;
let paused=false, soundOn=true;
let level="Beginner";

// Track mistakes by category
let categoryMistakes={};

function shuffle(a){return a.sort(()=>Math.random()-0.5)}

function startGame(selectedLevel){
  level=selectedLevel;
  challenges=shuffle(allChallenges[level]);
  current=0; score=0; correct=0; wrong=0; timeout=0;
  categoryMistakes={};
  document.getElementById("start-screen").style.display="none";
  document.getElementById("game-container").style.display="block";
  loadChallenge();
}

function loadChallenge(){
  clearInterval(timer);
  paused=false;
  timeLeft=20;
  const c=challenges[current];

  document.getElementById("challenge-number").textContent=`${level} - Challenge ${current+1} / ${challenges.length}`;
  document.getElementById("challenge").textContent=c.q;
  document.getElementById("feedback").textContent="";
  document.getElementById("hint-text").textContent="";
  document.getElementById("score").textContent=`Score: ${score}`;

  // Random card color
  const colors=["#0f172a","#1e293b","#1e40af","#047857","#7c3aed","#d97706","#b91c1c"];
  document.querySelector(".card").style.background=colors[Math.floor(Math.random()*colors.length)];

  const optDiv=document.getElementById("options");
  optDiv.innerHTML="";
  c.o.forEach((text,i)=>{
    const b=document.createElement("button");
    b.textContent=text;
    b.onclick=()=>checkAnswer(i);
    optDiv.appendChild(b);
  });

  document.getElementById("progress-bar").style.width = `${(current/challenges.length)*100}%`;
  document.getElementById("timer").textContent=`Time: ${timeLeft}s`;

  timer=setInterval(()=>{
    if(paused) return;
    timeLeft--;
    document.getElementById("timer").textContent=`Time: ${timeLeft}s`;
    if(timeLeft<=0){
      clearInterval(timer);
      timeout++;
      categoryMistakes[c.cat]=(categoryMistakes[c.cat]||0)+1;
      feedbackFlash("‚è∞ Time's up! "+c.e,"var(--bad)");
      setTimeout(nextChallenge,1200);
    }
  },1000);
}

function playSound(id){
  if(!soundOn) return;
  const s=document.getElementById(id);
  s.currentTime=0; s.play();
}

function checkAnswer(i){
  clearInterval(timer);
  const c=challenges[current];
  if(i===c.a){
    score++; correct++;
    feedbackFlash("‚úÖ Correct! "+c.e,"var(--good)");
  }else{
    wrong++;
    feedbackFlash("‚ùå Wrong! "+c.e,"var(--bad)");
    categoryMistakes[c.cat]=(categoryMistakes[c.cat]||0)+1;
  }
  playSound(i===c.a?"correct-sound":"wrong-sound");
  document.getElementById("score").textContent=`Score: ${score}`;
  setTimeout(nextChallenge,1200);
}

function feedbackFlash(msg,color){
  const fb=document.getElementById("feedback");
  fb.textContent=msg;
  fb.style.color=color;
  fb.style.transform="scale(1.1)";
  setTimeout(()=>{ fb.style.transform="scale(1)"; fb.style.color="#e5e7eb"; },500);
}

function nextChallenge(){
  current++;
  if(current<challenges.length) loadChallenge();
  else showReport();
}

function showHint(){
  document.getElementById("hint-text").textContent="üí° Hint: "+challenges[current].h;
}

function togglePause(){
  paused=!paused;
  document.getElementById("feedback").textContent = paused ? "‚è∏Ô∏è Paused" : "";
}

function toggleSound(){
  soundOn=!soundOn;
  alert("Sound: "+(soundOn?"ON":"OFF"));
}

function getRank(ratio){
  if(ratio===1) return "üèÜ Cyber Hero";
  if(ratio>=0.8) return "ü•á Cyber Pro";
  if(ratio>=0.5) return "ü•à Cyber Learner";
  return "ü•â Cyber Rookie";
}

function showReport(){
  let bestScoreKey="best-"+level;
  let bestScore=localStorage.getItem(bestScoreKey)||0;
  if(score>bestScore) localStorage.setItem(bestScoreKey,score);
  const ratio = score / challenges.length;
  const rank=getRank(ratio);

  // Build improvement tips
  let tips="";
  for(let cat in categoryMistakes){
    tips+=`<div class="tip">üí° Improve ${cat}: Mistakes: ${categoryMistakes[cat]}</div>`;
  }

  document.getElementById("game-container").innerHTML=`
    <h1>üéâ Game Report - ${level}</h1>
    <p>Score: <b>${score} / ${challenges.length}</b></p>
    <p>‚úÖ Correct: ${correct} | ‚ùå Wrong: ${wrong} | ‚è∞ Timeout: ${timeout}</p>
    <div class="badge">${rank}</div>
    <p class="small">High Score: ${localStorage.getItem(bestScoreKey)}</p>
    ${tips || '<p>No major mistakes! Great job!</p>'}
    <p>Keep practicing to stay safe online! üîê</p>
    <button class="btn" onclick="location.reload()">Play Again</button>
  `;
  
  // Update high scores display
  document.getElementById("best-Beginner").textContent=localStorage.getItem("best-Beginner")||0;
  document.getElementById("best-Intermediate").textContent=localStorage.getItem("best-Intermediate")||0;
  document.getElementById("best-Advanced").textContent=localStorage.getItem("best-Advanced")||0;
}
</script>
</body>
</html>
